
[2020-04-26T07:46:27.612Z] Error: Error deploying hasura: CrashLoopBackOff - back-off 1m20s restarting failed container=hasura pod=hasura-v-372ece5564-84bc74ff9-4759k_asd20-analytics(892828b1-da69-4370-97d1-46215aafe3fc)

━━━ Events ━━━
Deployment hasura-v-372ece5564: ScalingReplicaSet - Scaled up replica set hasura-v-372ece5564-84bc74ff9 to 1
Pod hasura-v-372ece5564-84bc74ff9-4759k: Scheduled - Successfully assigned asd20-analytics/hasura-v-372ece5564-84bc74ff9-4759k to minikube
Pod hasura-v-372ece5564-84bc74ff9-4759k: Pulled - Container image "hasura/graphql-engine:latest.cli-migrations" already present on machine
Pod hasura-v-372ece5564-84bc74ff9-4759k: Created - Created container hasura
Pod hasura-v-372ece5564-84bc74ff9-4759k: Started - Started container hasura
Pod hasura-v-372ece5564-84bc74ff9-4759k: BackOff - Back-off restarting failed container

━━━ Pod logs ━━━
<Showing last 20 lines per pod in this Deployment. Run the following command for complete logs>
$ kubectl -n asd20-analytics --context=minikube logs deployment/hasura-v-372ece5564

****** hasura-v-372ece5564-84bc74ff9-4759k ******
------ hasura ------{"timestamp":"2020-04-26T07:45:05.000+0000","level":"info","type":"startup","detail":{"kind":"migration-apply","info":"database url for migrations is set by HASURA_GRAPHQL_DATABASE_URL"}}
{"timestamp":"2020-04-26T07:45:05.000+0000","level":"info","type":"startup","detail":{"kind":"migration-apply","info":"migrations server port env var is not set, defaulting to 9691"}}
{"timestamp":"2020-04-26T07:45:05.000+0000","level":"info","type":"startup","detail":{"kind":"migration-apply","info":"server timeout is not set, defaulting to 30 seconds"}}
{"timestamp":"2020-04-26T07:45:05.000+0000","level":"info","type":"startup","detail":{"kind":"migration-apply","info":"starting graphql engine temporarily on port 9691"}}
{"timestamp":"2020-04-26T07:45:05.000+0000","level":"info","type":"startup","detail":{"kind":"migration-apply","info":"waiting 30 for 9691 to be ready"}}
{"type":"startup","timestamp":"2020-04-26T07:45:05.573+0000","level":"info","detail":{"kind":"server_configuration","info":{"live_query_options":{"batch_size":100,"refetch_delay":1},"transaction_isolation":"ISOLATION LEVEL READ COMMITTED","plan_cache_options":{"plan_cache_size":null},"enabled_log_types":["http-log","websocket-log","startup","webhook-log","query-log"],"server_host":"HostAny","enable_allowlist":false,"log_level":"info","auth_hook_mode":"GET","use_prepared_statements":true,"unauth_role":null,"stringify_numeric_types":false,"enabled_apis":["metadata"],"enable_telemetry":true,"enable_console":true,"auth_hook":"http://host.docker.internal:7071/authenticate-hasura","jwt_secret":null,"cors_config":{"allowed_origins":"*","disabled":false,"ws_read_cookie":null},"console_assets_dir":null,"admin_secret_set":true,"port":9691}}}
{"type":"startup","timestamp":"2020-04-26T07:45:05.573+0000","level":"info","detail":{"kind":"postgres_connection","info":{"retries":1,"database_url":"postgres://admin:@postgres:5432/analytics"}}}
{"internal":"could not translate host name \"postgres\" to address: Name or service not known\n","path":"$","error":"connection error","code":"postgres-error"}
{"timestamp":"2020-04-26T07:45:35.000+0000","level":"info","type":"startup","detail":{"kind":"migration-apply","info":"failed waiting for 9691"}}

    at Object.<anonymous> (/snapshot/project/garden-service/tmp/dist/build/src/plugins/kubernetes/status/status.js:0)
    at Generator.next (<anonymous>)
    at fulfilled (/snapshot/project/garden-service/tmp/dist/build/src/plugins/kubernetes/status/status.js:0)
    at runNextTicks (internal/process/task_queues.js:58:5)
    at processImmediate (internal/timers.js:412:9)
    at process.topLevelDomainCallback (domain.js:130:23)
Error Details:
serviceName: hasura
status:
  state: unhealthy
  lastMessage: >-
    CrashLoopBackOff - back-off 1m20s restarting failed container=hasura
    pod=hasura-v-372ece5564-84bc74ff9-4759k_asd20-analytics(892828b1-da69-4370-97d1-46215aafe3fc)
  logs: "\e[37m━━━ Events ━━━\e[39m\n\e[94mDeployment hasura-v-372ece5564:\e[39m \e[37mScalingReplicaSet - Scaled up replica set hasura-v-372ece5564-84bc74ff9 to 1\e[39m\n\e[94mPod hasura-v-372ece5564-84bc74ff9-4759k:\e[39m \e[37mScheduled - Successfully assigned asd20-analytics/hasura-v-372ece5564-84bc74ff9-4759k to minikube\e[39m\n\e[94mPod hasura-v-372ece5564-84bc74ff9-4759k:\e[39m \e[37mPulled - Container image \"hasura/graphql-engine:latest.cli-migrations\" already present on machine\e[39m\n\e[94mPod hasura-v-372ece5564-84bc74ff9-4759k:\e[39m \e[37mCreated - Created container hasura\e[39m\n\e[94mPod hasura-v-372ece5564-84bc74ff9-4759k:\e[39m \e[37mStarted - Started container hasura\e[39m\n\e[94mPod hasura-v-372ece5564-84bc74ff9-4759k:\e[39m \e[33mBackOff - Back-off restarting failed container\e[39m\e[37m\e[39m\n\e[37m\e[39m\n\e[37m━━━ Pod logs ━━━\e[39m\n\e[37m\e[39m\e[90m<Showing last 20 lines per pod in this Deployment. Run the following command for complete logs>\e[39m\n\e[90m$ kubectl -n asd20-analytics --context=minikube logs deployment/hasura-v-372ece5564\e[39m\n\e[94m\e[39m\n\e[94m****** hasura-v-372ece5564-84bc74ff9-4759k ******\e[39m\n\e[94m\e[39m\e[90m------ hasura ------\e[39m{\"timestamp\":\"2020-04-26T07:45:05.000+0000\",\"level\":\"info\",\"type\":\"startup\",\"detail\":{\"kind\":\"migration-apply\",\"info\":\"database url for migrations is set by HASURA_GRAPHQL_DATABASE_URL\"}}\n{\"timestamp\":\"2020-04-26T07:45:05.000+0000\",\"level\":\"info\",\"type\":\"startup\",\"detail\":{\"kind\":\"migration-apply\",\"info\":\"migrations server port env var is not set, defaulting to 9691\"}}\n{\"timestamp\":\"2020-04-26T07:45:05.000+0000\",\"level\":\"info\",\"type\":\"startup\",\"detail\":{\"kind\":\"migration-apply\",\"info\":\"server timeout is not set, defaulting to 30 seconds\"}}\n{\"timestamp\":\"2020-04-26T07:45:05.000+0000\",\"level\":\"info\",\"type\":\"startup\",\"detail\":{\"kind\":\"migration-apply\",\"info\":\"starting graphql engine temporarily on port 9691\"}}\n{\"timestamp\":\"2020-04-26T07:45:05.000+0000\",\"level\":\"info\",\"type\":\"startup\",\"detail\":{\"kind\":\"migration-apply\",\"info\":\"waiting 30 for 9691 to be ready\"}}\n{\"type\":\"startup\",\"timestamp\":\"2020-04-26T07:45:05.573+0000\",\"level\":\"info\",\"detail\":{\"kind\":\"server_configuration\",\"info\":{\"live_query_options\":{\"batch_size\":100,\"refetch_delay\":1},\"transaction_isolation\":\"ISOLATION LEVEL READ COMMITTED\",\"plan_cache_options\":{\"plan_cache_size\":null},\"enabled_log_types\":[\"http-log\",\"websocket-log\",\"startup\",\"webhook-log\",\"query-log\"],\"server_host\":\"HostAny\",\"enable_allowlist\":false,\"log_level\":\"info\",\"auth_hook_mode\":\"GET\",\"use_prepared_statements\":true,\"unauth_role\":null,\"stringify_numeric_types\":false,\"enabled_apis\":[\"metadata\"],\"enable_telemetry\":true,\"enable_console\":true,\"auth_hook\":\"http://host.docker.internal:7071/authenticate-hasura\",\"jwt_secret\":null,\"cors_config\":{\"allowed_origins\":\"*\",\"disabled\":false,\"ws_read_cookie\":null},\"console_assets_dir\":null,\"admin_secret_set\":true,\"port\":9691}}}\n{\"type\":\"startup\",\"timestamp\":\"2020-04-26T07:45:05.573+0000\",\"level\":\"info\",\"detail\":{\"kind\":\"postgres_connection\",\"info\":{\"retries\":1,\"database_url\":\"postgres://admin:@postgres:5432/analytics\"}}}\n{\"internal\":\"could not translate host name \\\"postgres\\\" to address: Name or service not known\\n\",\"path\":\"$\",\"error\":\"connection error\",\"code\":\"postgres-error\"}\n{\"timestamp\":\"2020-04-26T07:45:35.000+0000\",\"level\":\"info\",\"type\":\"startup\",\"detail\":{\"kind\":\"migration-apply\",\"info\":\"failed waiting for 9691\"}}\n"
  resource:
    kind: Deployment
    apiVersion: apps/v1
    metadata:
      name: hasura-v-372ece5564
      namespace: asd20-analytics
      selfLink: /apis/apps/v1/namespaces/asd20-analytics/deployments/hasura-v-372ece5564
      uid: 6c1e6b44-c97c-4aed-b038-4fbaed1bffaa
      resourceVersion: '36436'
      generation: 1
      creationTimestamp: '2020-04-26T07:41:39Z'
      labels:
        garden.io/version: v-372ece5564
        module: hasura
        service: hasura
      annotations:
        deployment.kubernetes.io/revision: '1'
        garden.io/configured.replicas: '1'
        garden.io/generated: 'true'
        garden.io/manifest-hash: 68963fe59d4870d0225aa2022992ebddf13935763e870846f5efc413d5ad9250
        garden.io/version: v-372ece5564
        kubectl.kubernetes.io/last-applied-configuration: >
          {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{"garden.io/configured.replicas":"1","garden.io/generated":"true","garden.io/manifest-hash":"68963fe59d4870d0225aa2022992ebddf13935763e870846f5efc413d5ad9250","garden.io/version":"v-372ece5564"},"labels":{"garden.io/version":"v-372ece5564","module":"hasura","service":"hasura"},"name":"hasura-v-372ece5564","namespace":"asd20-analytics"},"spec":{"replicas":1,"revisionHistoryLimit":3,"selector":{"matchLabels":{"garden.io/version":"v-372ece5564","service":"hasura"}},"strategy":{"rollingUpdate":{"maxSurge":1,"maxUnavailable":1},"type":"RollingUpdate"},"template":{"metadata":{"labels":{"garden.io/version":"v-372ece5564","module":"hasura","service":"hasura"}},"spec":{"containers":[{"env":[{"name":"GARDEN_VERSION","value":"v-372ece5564"},{"name":"GARDEN_DEPENDENCIES","value":"[{\"moduleName\":\"hasura\",\"name\":\"hasura\",\"type\":\"build\",\"version\":\"v-372ece5564\"},{\"moduleName\":\"postgres\",\"name\":\"postgres\",\"type\":\"service\",\"version\":\"v-12a346cf78\"}]"},{"name":"HASURA_GRAPHQL_ADMIN_SECRET","value":"admin"},{"name":"HASURA_GRAPHQL_DATABASE_URL","value":"postgres://admin:@postgres:5432/analytics"},{"name":"HASURA_GRAPHQL_ENABLE_CONSOLE","value":"true"},{"name":"HASURA_GRAPHQL_ENABLED_LOG_TYPES","value":"startup,
          http-log, webhook-log, websocket-log,
          query-log"},{"name":"HASURA_GRAPHQL_AUTH_HOOK","value":"http://host.docker.internal:7071/authenticate-hasura"},{"name":"HASURA_GRAPHQL_DBNAME","value":"analytics"},{"name":"POD_HOST_IP","valueFrom":{"fieldRef":{"fieldPath":"status.hostIP"}}},{"name":"POD_IP","valueFrom":{"fieldRef":{"fieldPath":"status.podIP"}}},{"name":"POD_NAME","valueFrom":{"fieldRef":{"fieldPath":"metadata.name"}}},{"name":"POD_NAMESPACE","valueFrom":{"fieldRef":{"fieldPath":"metadata.namespace"}}},{"name":"POD_NODE_NAME","valueFrom":{"fieldRef":{"fieldPath":"spec.nodeName"}}},{"name":"POD_SERVICE_ACCOUNT","valueFrom":{"fieldRef":{"fieldPath":"spec.serviceAccountName"}}},{"name":"POD_UID","valueFrom":{"fieldRef":{"fieldPath":"metadata.uid"}}}],"image":"hasura/graphql-engine:latest.cli-migrations","imagePullPolicy":"IfNotPresent","name":"hasura","ports":[{"containerPort":8080,"name":"hasura-console","protocol":"TCP"}],"resources":{"limits":{"cpu":"1","memory":"1Gi"},"requests":{"cpu":"10m","memory":"64Mi"}},"securityContext":{"allowPrivilegeEscalation":false}}],"dnsPolicy":"ClusterFirst","restartPolicy":"Always","terminationGracePeriodSeconds":5}}}}
      managedFields: []
    spec:
      replicas: 1
      selector:
        matchLabels:
          garden.io/version: v-372ece5564
          service: hasura
      template:
        metadata:
          creationTimestamp: null
          labels:
            garden.io/version: v-372ece5564
            module: hasura
            service: hasura
        spec:
          containers: []
          restartPolicy: Always
          terminationGracePeriodSeconds: 5
          dnsPolicy: ClusterFirst
          securityContext: {}
          schedulerName: default-scheduler
      strategy:
        type: RollingUpdate
        rollingUpdate:
          maxUnavailable: 1
          maxSurge: 1
      revisionHistoryLimit: 3
      progressDeadlineSeconds: 600
    status:
      observedGeneration: 1
      replicas: 1
      updatedReplicas: 1
      unavailableReplicas: 1
      conditions: []

